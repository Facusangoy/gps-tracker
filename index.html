<!DOCTYPE html>
<html>
<head>
  <title>GPS Tracker</title>
  <meta charset="utf-8" />
  <style>
    #map { height: 100vh; width: 100vw; }
  </style>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script type="module">
    // Configuración de tu Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDCAeiry0hq9dXzF-wSXIw-UQhikcEUKlw",
      authDomain: "seguidor-gps-8d711.firebaseapp.com",
      databaseURL: "https://seguidor-gps-8d711-default-rtdb.firebaseio.com",
      projectId: "seguidor-gps-8d711",
      storageBucket: "seguidor-gps-8d711.appspot.com",
      messagingSenderId: "270214199159",
      appId: "1:270214199159:web:b46cdd2c961db063244fd8"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const latRef = ref(db, 'ubicacion/latitud');
    const lngRef = ref(db, 'ubicacion/longitud');

    let map = L.map('map').setView([-31.4, -64.2], 15); // Coordenadas iniciales Córdoba
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    let marker = L.marker([-31.4, -64.2]).addTo(map).bindPopup("Ubicación GPS");

    function actualizarMapa(lat, lng) {
      marker.setLatLng([lat, lng]);
      map.setView([lat, lng], 17);
      marker.bindPopup(`Lat: ${lat.toFixed(5)}<br>Lng: ${lng.toFixed(5)}`).openPopup();
    }

    let lat = 0;
    let lng = 0;

    onValue(latRef, (snapshot) => {
      lat = snapshot.val();
      if (lat && lng) actualizarMapa(lat, lng);
    });

    onValue(lngRef, (snapshot) => {
      lng = snapshot.val();
      if (lat && lng) actualizarMapa(lat, lng);
    });
  </script>
</body>
</html>
